<%@ page contentType="text/html; charset=utf-8" pageEncoding="utf-8" %>
<%@ taglib prefix="c"       uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="form"    uri="http://www.springframework.org/tags/form" %>
<%@ taglib prefix="ui"      uri="http://egovframework.gov/ctl/ui" %>
<%@ taglib prefix="spring"  uri="http://www.springframework.org/tags" %>

{{~setVar "voInstanceName" (concat classNameFirstCharLower "VO")~}}
{{~setVar "listPath" (concat "/" classNameFirstCharLower "/" classNameFirstCharLower "List.do")~}}
{{~setVar "addViewPath" (concat "/" classNameFirstCharLower "/add" className "View.do")~}}
{{~setVar "updateViewPath" (concat "/" classNameFirstCharLower "/update" className "View.do")~}}

<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>List</title>

	<!-- KRDS CSS -->
	<link type="text/css" rel="stylesheet" href="<c:url value='/css/component/output.css'/>" />
	<link type="text/css" rel="stylesheet" href="<c:url value='/css/egovframe.css'/>" />
	<script type="text/javaScript" language="javascript" src="<c:url value='/js/jquery.min.js'/>" defer="defer"></script>
	<script type="text/javaScript" language="javascript" src="<c:url value='/js/egovframework/common.js'/>" defer="defer"></script>

	<script type="text/javaScript" language="javascript" defer="defer">
	<!--
		/* 글 수정 화면 function */
		function fn_egov_select({{#if pkAttributes.length}}{{#each pkAttributes}}{{this.ccName}}{{#unless @last}}, {{/unless}}{{/each}}{{else}}{{attributes.[0].ccName}}{{/if}}) {
			{{#if pkAttributes.length}}
			  {{#each pkAttributes}}
			document.getElementById("listForm").{{this.ccName}}.value = {{this.ccName}};
			  {{/each}}
			{{else}}
			document.getElementById("listForm").{{attributes.[0].ccName}}.value = {{attributes.[0].ccName}};
			{{/if}}
			document.getElementById("listForm").action = "<c:url value='{{updateViewPath}}'/>";
			document.getElementById("listForm").submit();
		}

		/* 글 등록 화면 function */
		function fn_egov_addView() {
			document.getElementById("listForm").action = "<c:url value='{{addViewPath}}'/>";
			document.getElementById("listForm").submit();
		}

		/* 글 목록 화면 function */
		function fn_egov_selectList() {
			if(document.getElementById("listForm").searchKeyword.value == '') {
				alert("Please enter search keyword");
				return false;
			}
			document.getElementById("listForm").action = "<c:url value='{{listPath}}'/>";
			document.getElementById("listForm").submit();
		}

		/* pagination 페이지 링크 function */
		function fn_egov_link_page(pageNo) {
			document.getElementById("listForm").pageIndex.value = pageNo;
			document.getElementById("listForm").action = "<c:url value='{{listPath}}'/>";
			document.getElementById("listForm").submit();
		}
	//-->
	</script>
</head>

<body>
<div id="container" class="inner">

	<!-- Title -->
	<h2 class="heading-large">List</h2>
	<!-- // Title -->

	<div id="content_pop">
		<form:form modelAttribute="{{voInstanceName}}" id="listForm" name="listForm" method="get">
			
			<!-- Select Condition (Hidden Fields) - 게시물 조회 조건 -->
			{{#if pkAttributes.length}}
			  {{#each pkAttributes}}
			<input type="hidden" id="{{this.ccName}}" name="{{this.ccName}}" />
			  {{/each}}
			{{else}}
			<input type="hidden" id="{{attributes.[0].ccName}}" name="{{attributes.[0].ccName}}" />
			{{/if}}
			<input type="hidden" id="pageIndex" name="pageIndex" value="1" />

			<!-- Search Form -->
			<div class="form-group">
				<div class="search-wrap">
					<div class="search-body">
						<div class="form-conts searchOption">
							<select id="searchCondition" name="searchCondition" class="krds-form-select medium" title="Choose search condition">
								{{#if pkAttributes.length}}
								  {{#if (eq pkAttributes.length 1)}}
								    {{!-- Case 1. PK 컬럼이 있고, 1개 뿐이라면 : PK 컬럼을 제외한 일반 컬럼 중 맨 앞의 1개와 PK 컬럼이 검색 조건 --}}
								    {{~setVar "foundFirst" false~}}
								    {{#each attributes}}
								      {{#unless isPrimaryKey}}{{#unless @root.foundFirst}}
								<option value="1" <c:if test ="${not empty {{@root.voInstanceName}}.searchCondition and {{@root.voInstanceName}}.searchCondition eq 1}">selected="selected"</c:if>>{{pcName}}</option>
								        {{~setVar "foundFirst" true~}}
								      {{/unless}}{{/unless}}
								    {{/each}}
								<option value="0" <c:if test ="${not empty {{voInstanceName}}.searchCondition and {{voInstanceName}}.searchCondition eq 0}">selected="selected"</c:if>>{{pkAttributes.[0].pcName}}</option>
								  {{else}}
								    {{!-- Case 2. PK 컬럼이 있고, 2개 이상이라면 : PK 컬럼 2개가 검색 조건 --}}
								<option value="1" <c:if test ="${not empty {{voInstanceName}}.searchCondition and {{voInstanceName}}.searchCondition eq 1}">selected="selected"</c:if>>{{pkAttributes.[1].pcName}}</option>
								<option value="0" <c:if test ="${not empty {{voInstanceName}}.searchCondition and {{voInstanceName}}.searchCondition eq 0}">selected="selected"</c:if>>{{pkAttributes.[0].pcName}}</option>
								  {{/if}}
								{{else}}
								  {{!-- Case 3. PK 컬럼이 없다면 : 일반 컬럼 앞 2개가 검색 조건 --}}
								<option value="1" <c:if test ="${not empty {{voInstanceName}}.searchCondition and {{voInstanceName}}.searchCondition eq 1}">selected="selected"</c:if>>{{attributes.[1].pcName}}</option>
								<option value="0" <c:if test ="${not empty {{voInstanceName}}.searchCondition and {{voInstanceName}}.searchCondition eq 0}">selected="selected"</c:if>>{{attributes.[0].pcName}}</option>
								{{/if}}
							</select>
						</div>
						<div class="form-conts btn-ico-wrap searchKeyword">
							<input type="text" id="searchKeyword" name="searchKeyword" value="{{concat "${" voInstanceName ".searchKeyword}"}}" class="krds-input medium" placeholder="Search keyword">
							<button type="button" class="krds-btn medium icon" onclick="fn_egov_selectList()">
								<span class="sr-only">search" />Search</span>
								<i class="svg-icon ico-sch"></i>
							</button>
						</div>
					</div>
					<div class="page-btn-wrap">
						<button type="button" class="krds-btn medium" onclick="fn_egov_addView()">Regist</button>
					</div>
				</div>
			</div>
		</form:form>

		<!-- List -->
		<div class="krds-table-wrap">
			<table class="tbl col data">
				<colgroup>
					<col style="width: 10%;">
					{{#each attributes}}
					<col style="width: auto;">
					{{/each}}
				</colgroup>

				<thead>
					<tr>
						<th scope="col" class="text-center">No</th>
						{{#each attributes}}
						<th scope="col" class="text-center">{{pcName}}</th>
						{{/each}}
					</tr>
				</thead>

				<tbody>
					<c:choose>
						<c:when test="${not empty resultList}">
							<c:forEach var="result" items="${resultList}" varStatus="status">
								<tr>
									<!-- 순번 계산 -->
									<td class="text-center"><c:out value="${paginationInfo.totalRecordCount+1 - (({{voInstanceName}}.pageIndex-1) * {{voInstanceName}}.pageSize + status.count)}"/></td>
									{{#each attributes}}
									  {{#if isPrimaryKey}}
									<!-- PK 컬럼: 클릭 가능한 링크 / 이 result 객체의 모든 PK 컬럼들이 SQL 문의 WHERE 조건에 사용됨 -->
									<td class="text-center"><a href="javascript:fn_egov_select({{#each @root.pkAttributes}}'<c:out value="{{concat "${result." ccName "}"}}"/>'{{#unless @last}}, {{/unless}}{{/each}})"><c:out value="{{concat "${result." ccName "}" }}" /></a></td>
									  {{else}}
									    {{#unless @root.pkAttributes.length}}
									      {{#if @first}}
									<!-- PK 컬럼이 없다면, 첫 번째 컬럼이 PK 역할 수행하여 SQL문의 WHERE 조건에 사용됨 -->
									<td class="text-center"><a href="javascript:fn_egov_select('<c:out value="{{concat "${result." ccName "}"}}"/>')"><c:out value="{{concat "${result." ccName "}" }}" /></a></td>
									      {{else}}
									<!-- 일반 컬럼: 단순 출력 -->
									<td class="text-center"><c:out value="{{concat "${result." ccName "}"}}" /></td>
									      {{/if}}
									    {{else}}
									<!-- 일반 컬럼: 단순 출력 -->
									<td class="text-center"><c:out value="{{concat "${result." ccName "}"}}" /></td>
									    {{/unless}}
									  {{/if}}
									{{/each}}
								</tr>
							</c:forEach>
						</c:when>
						<c:otherwise>
							<tr>
								<td class="text-center" colspan="{{add attributes.length 1}}">No data found</td>
							</tr>
						</c:otherwise>
					</c:choose>
				</tbody>
			</table>
		</div>
		<!-- // List -->

		<!-- Pagination -->
		<div id="paging" class="krds-pagination w-page">
			<ui:pagination paginationInfo="${paginationInfo}" type="krds" jsFunction="fn_egov_link_page" />
		</div>

	</div>

</div>

</body>
</html>
