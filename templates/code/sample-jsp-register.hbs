<%@ page contentType="text/html; charset=utf-8" pageEncoding="utf-8"%>
<%@ taglib prefix="c"         uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="form"      uri="http://www.springframework.org/tags/form" %>
<%@ taglib prefix="spring"    uri="http://www.springframework.org/tags"%>

{{~setVar "voInstanceName" (concat classNameFirstCharLower "VO")~}}
{{~setVar "listPath" (concat "/" classNameFirstCharLower "/" classNameFirstCharLower "List.do")~}}
{{~setVar "addPath" (concat "/" classNameFirstCharLower "/add" className ".do")~}}
{{~setVar "updatePath" (concat "/" classNameFirstCharLower "/update" className ".do")~}}
{{~setVar "deletePath" (concat "/" classNameFirstCharLower "/delete" className ".do")~}}

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <c:set var="registerFlag" value="${empty {{voInstanceName}}.{{#if pkAttributes.length}}{{pkAttributes.[0].ccName}}{{else}}{{attributes.[0].ccName}}{{/if}} ? 'create' : 'modify'}"/>
    <title>{{className}} <c:if test="${registerFlag == 'create'}">Regist</c:if>
                  <c:if test="${registerFlag == 'modify'}">Update</c:if>
    </title>

    <!-- KRDS CSS -->
    <link rel="stylesheet" type="text/css" href="<c:url value='/css/component/output.css'/>" />
    <link rel="stylesheet" type="text/css" href="<c:url value='/css/egovframe.css'/>" />
    <script type="text/javascript" src="<c:url value='/js/jquery.min.js'/>"></script>
    <script type="text/javascript" src="<c:url value='/js/component/ui-script.js'/>" defer></script>
    <script type="text/javascript" src="<c:url value='/js/egovframework/common.js'/>" defer></script>

    <!--For Custom Validation-->
    <!-- egovframe-Todo: Validator 적용시 아래 주석 코드 참고 -->
    <!-- <script type="text/javascript" src="<c:url value='/js/egovframework/EgovValidation.js'/>" defer></script> -->

    <script type="text/javascript" defer>

    function fn_egov_list() {
    	document.getElementById("detailForm").action = "<c:url value='{{listPath}}'/>";
       	document.getElementById("detailForm").method = 'get';
       	document.getElementById("detailForm").submit();
    }

    function fn_egov_add() {
        if (confirm('Are you sure you want to register?')) {
            let frm = document.getElementById("detailForm");
            // egovframe-Todo: Validator 적용시 아래 주석 코드 참고
            // EgovValidation.js 파일에 validate{{className}}VO 함수 추가 필요
            // if (!validate{{className}}VO(frm)) {
            //     return;
            // }
            frm.action = "<c:url value='{{addPath}}'/>";
            frm.submit();
        }
    }

    function fn_egov_update() {
        if (confirm('Are you sure you want to modify?')) {
            let frm = document.getElementById("detailForm");
            // egovframe-Todo: Validator 적용시 아래 주석 코드 참고
            // EgovValidation.js 파일에 validate{{className}}VO 함수 추가 필요
            // if (!validate{{className}}VO(frm)) {
            //     return;
            // }
            frm.action = "<c:url value='{{updatePath}}'/>";
            frm.submit();
        }
    }

    function fn_egov_delete() {
        if (confirm('Are you sure you want to delete?')) {
        	document.getElementById("detailForm").action = "<c:url value='{{deletePath}}'/>";
           	document.getElementById("detailForm").submit();
        }
    }

    function fn_egov_reset() {
        $('form').each(function() {
            this.reset();
        });
    }
    </script>
</head>

<body>
<div id="container" class="inner">

	<!-- Page Title -->
	<h2 class="heading-large">
		<c:if test="${registerFlag == 'create'}">Regist</c:if>
		<c:if test="${registerFlag == 'modify'}">Update</c:if>
	</h2>

	<form:form id="detailForm" name="detailForm" modelAttribute="{{voInstanceName}}">
    <input type="hidden" id="searchCondition" name="searchCondition" value="{{concat "${" voInstanceName ".searchCondition}"}}" />
    <input type="hidden" id="searchKeyword" name="searchKeyword" value="{{concat "${" voInstanceName ".searchKeyword}"}}" />
    <input type="hidden" id="pageIndex" name="pageIndex" value="{{concat "${" voInstanceName ".pageIndex}"}}" />

		<div class="conts-wrap">
			<div class="fieldset input-form">
                {{#each attributes}}
                  {{#if isPrimaryKey}}
                <c:if test="{{concat "${not empty " @root.voInstanceName "." ccName "}"}}">
                <div class="form-group">
                    <div class="form-tit">
                        <label for="{{ccName}}">{{pcName}}</label>
                    </div>
                    <div class="form-conts">
                        <form:input path="{{ccName}}" readonly="true" cssClass="krds-input"/>
                    </div>
                </div>
                </c:if>
                  {{else}}

                <div class="form-group">
                    <div class="form-tit">
                        <label for="{{ccName}}">{{pcName}}</label>
                    </div>
                    <div class="form-conts">
                        <form:input path="{{ccName}}" cssClass="krds-input" />
                        <form:errors path="{{ccName}}" cssClass="error-message" />
                    </div>
                </div>
                  {{/if}}
                {{/each}}

            </div>

			<!-- Action Buttons -->
			<div class="page-btn-wrap">
                <div class="btn-wrap">
	                <button type="button" class="krds-btn medium secondary" onclick="fn_egov_list()">List</button>
	                <button type="button" class="krds-btn medium tertiary" onclick="fn_egov_reset()">Reset</button>
                </div>
				<div class="btn-wrap">
					<c:if test="${registerFlag == 'modify'}">
						<button type="button" class="krds-btn medium" onclick="fn_egov_update()">Update</button>
						<button type="button" class="krds-btn medium danger" onclick="fn_egov_delete()">Delete</button>
					</c:if>
					<c:if test="${registerFlag == 'create'}">
						<button type="button" class="krds-btn medium" onclick="fn_egov_add()">Regist</button>
					</c:if>
				</div>
	        </div>
		</div>

	</form:form>

</div>

</body>
</html>
